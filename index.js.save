const { default: axios } = require('axios');
const express = require('express');
const app = express();
const axios = require('axios');

app.use(express.json());

const books = [
  { titulo: "O Código Da Vinci", autor: "Dan Brown" },
  { titulo: "Garota Exemplar", autor: "Gillian Flynn" },
  { titulo: "Como Fazer Amigos e Influenciar Pessoas", autor: "Dale Carnegie" },
  { titulo: "Orgulho e Preconceito", autor: "Jane Austen" },
  { titulo: "O Hobbit", autor: "J.R.R. Tolkien" },
  { titulo: "A Culpa é das Estrelas", autor: "John Green" },
  { titulo: "O Poder do Hábito", autor: "Charles Duhigg" },
  { titulo: "A Sutil Arte de Ligar o F*da-se", autor: "Mark Manson" },
  { titulo: "O Silêncio dos Inocentes", autor: "Thomas Harris" },
  { titulo: "As Aventuras de Huckleberry Finn", autor: "Mark Twain" }
];

app.get('https://api-support-aws.sensedia.com//api/livros/pesquisa', function (req,res){
    res.json(books); /*envia como string JSON e o stringify() define o cabeçalho automaticamente, ou seja, aquele content-type:..*/
});

app.post('/new/books', (req, res) => {
    const { titulo, autor } = req.body;

    axios.get('https://api-support-aws.sensedia.com/api/livros/pesquisa')
        .then(response => {
res.json(response.data); 
res.status(500).json({ error: 'Erro ao obter dados do endpoint externo' });
        });
        });
    if (!titulo || !autor) {
        return res.status(400).json({ error: "Título e autor são obrigatórios." });
    }


    const newBook = { titulo, autor };
    books.push(newBook);

    res.status(201).json({ message: "Livro adicionado com sucesso!", book: newBook });
});



// app.get('/api/livros', function (req,res){
//     res.send(JSON.stringify(books)); /envia como string JSON e o stringify() define o cabeçalho automaticamente, ou seja, aquele content-type:../


//   res.json(livrosOrdenados);
// });





app.listen(3000);
console.log(`Backend para testa no desafio api-books`);
